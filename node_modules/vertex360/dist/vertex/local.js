var express=require("express"),path=require("path"),favicon=require("serve-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),sessions=require("client-sessions"),db=require("./db"),templateEngine=require("./template-engine");require("dotenv").config();const basePath=__dirname+"/../../../../",defaultConfiguration=function(e){var s=path.join(basePath,"public");e.use(express.static(s));var n=path.join(basePath,"views");e.set("views",n)},configureOptions=function(e,s){if(null==s)return;if(null==e)return void defaultConfiguration(s);const n=e.db;null!=n&&(null==n.type?db.connect(n.url,n.onError,n.onSuccess):"mongo"==n.type?db.connectMongo(n.url,n.onError,n.onSuccess):"nedb"==n.type?db.connectNedb(n.url,n.onError,n.onSuccess):db.connectMongo(n.url,n.onError,n.onSuccess));const r=e.views||"views";var o=path.join(basePath,r);s.set("views",o);const t=e.static||"public";var i=path.join(basePath,t);s.use(express.static(i))},expressInstance=function(e){var s=express();if(configureOptions(e,s),s.use(bodyParser.json()),s.use(bodyParser.urlencoded({extended:!1})),s.use(cookieParser()),s.use(logger("dev")),process.env.SESSION_SECRET){let n="vertexSession",r=process.env.SESSION_SECRET,o=864e5,t=18e5;null!=e&&null!=e.session&&(n=e.session.cookieName||"vertexSession",r=e.session.secret||process.env.SESSION_SECRET,o=e.session.duration||864e5,t=e.session.activeDuration||18e5),s.use(sessions({cookieName:n,secret:r,duration:o,activeDuration:t}))}return s.set("view engine","mustache"),s.engine("mustache",templateEngine.__express),s};module.exports={express:function(e){return expressInstance(e)},app:function(e){return expressInstance(e)},router:function(){return new express.Router}};