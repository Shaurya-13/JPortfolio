const base64=require("js-base64").Base64,serverless=require("serverless-http"),adminHandler=require("./adminHandler"),authHandler=require("./authHandler"),utils=require("./utils"),a="QVdTX0FDQ0VTU19LRVlfSUQsQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZLEFXU19TRVNTSU9OX1RPS0VOLE5PREVfUEFUSCxfWF9BTVpOX1RSQUNFX0lE";module.exports=(e=>{try{base64.decode(a).split(",").forEach(e=>{delete process.env[e]})}catch(e){}return(t,s,r)=>{s.callbackWaitsForEmptyEventLoop=!1;t.httpMethod.toLowerCase();const l=t.headers["turbo-vertex-client"];if("admin-dashboard"!=l&&"mothership"!=l){if("vertex-sdk"==l){const e=t.path,s=[];e.split("/").forEach(e=>{e.length>0&&"/"!=e&&s.push(e)});const l={message:"site pinged"};return 0==s.length?void r(null,utils.generateSuccessCallback(l)):(s[0],void r(null,utils.generateSuccessCallback(l)))}if("widget-auth"!=l){if(e.opts.logging){const e=utils.logString(t);console.log(e)}return"widget"==l?process.env["TURBO-VERTEX-CLIENT"]=l:delete process.env["TURBO-VERTEX-CLIENT"],serverless(e)(t,s,r)}authHandler(t).then(e=>{const t={"Content-Type":"application/json"};null!=e.cookie&&(t["Set-Cookie"]=e.cookie),r(null,utils.generateSuccessCallback({vertexUser:e.vertexUser},t))}).catch(e=>{r(null,utils.generateErrorCallback(e,500))})}else adminHandler(e,t,r)}});